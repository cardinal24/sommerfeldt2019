---
title: "psych251.reproducibility.analysis.stress-heart rate coherence"
author: "Kris Evans"
date: "11/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Packages
```{r message=FALSE}
library(readr)
library(tidyverse)
library(knitr)

```

### Read in processed data files 
Files generated in Prep_Coherence_MIDUSII.R script

```{r read in data}

setwd("~/R Mac working folder")

#load cleaned and merged data so farfrom this step and work from here - should have all the proper variables and merged diff data sets by M2ID
#should look wide and long data?

psych_251_repro_df <- read_csv("R Mac working folder/sommerfeldt2019/psych.251.repro.df.csv")

df <- psych_251_repro_df

```

```{r}
glimpse(df)


df %>% count(stress1)

```



```{r}
#drop participants from dataset who do not have stress and hr data timepoints minus stress/hr 6
#make stress and heart rate correlations

#drop stress - in paper mentioned only without five complete data points for sr stress but should also befor hr
df.s <- df %>% group_by(M2ID) %>% drop_na(stress1, stress2, stress3, stress4, stress5) %>% select(-stress6) 

#drophr framework but will keep HR in as isnt explicitly mentioned also some data spots arent good due to instrument rill return
df.shr <- df.s %>% group_by(M2ID) %>% drop_na(hr1, hr2, hr3, hr4, hr5) %>% select(-hr6)

#looks like 967 observations less than intended
summary(df.shr$IL6)

summary(df.shr$stress1)
summary(df.shr$stress2)
sd(df.shr$stress1)
sd(df.shr$stress2)


summarize(df.shr)



```
```{r}
 
```


```{r}

#rename var to separate easier
 df.shr1 <- rename(df.shr, stress_1 = stress1)
 
df.shr2 <- rename(df.shr1, stress_2 = stress2)
df.shr3 <- rename(df.shr2, stress_3 = stress3)  
df.shr4 <- rename(df.shr3, stress_4 = stress4)  
df.shr5 <- rename(df.shr4, stress_5 = stress5)  

df.shr6 <- rename(df.shr5, hr_1 = hr1) 
df.shr7 <- rename(df.shr6, hr_2 = hr2) 
df.shr8 <- rename(df.shr7, hr_3 = hr3) 
df.shr9 <- rename(df.shr8, hr_4 = hr4) 
df.shr10 <- rename(df.shr9, hr_5 = hr5) 
```

```{r}
wDF <- df.shr10

#pivot longer, each participant has 5 rows per stress or hr

df.Ls <- pivot_longer(df.shr10, cols = starts_with("stress"), names_to = c("stress","timepoint"), names_sep = "_", values_to = "stress_value")  
 
  
df.Lhr <- pivot_longer(df.shr10, cols = starts_with("hr"), names_to = c("hr", "timepoint"), names_sep = "_", values_to = "hr_value")
```

```{r}
#merge two long frames by tp and m2id

m.LDF <- merge(df.Ls, df.Lhr, 
                   by.x = c("M2ID", "timepoint"), 
                   by.y = c("M2ID", "timepoint"), 
                   all.x = TRUE, all.y = FALSE)

#select key variables needed for long dataframe
f.Ldf <- m.LDF %>% select(M2ID, timepoint, stress_value, hr_value, pwb2.x, COPE_denial.x, IL6.x, CRP.x, P4_CESD.x, P4_STAItrait.x, M2FAMNUM.x)

#key variables for wide df

f.Wdf <- wDF %>% select(M2ID, pwb2, COPE_denial, IL6, CRP, P4_CESD, P4_STAItrait, M2FAMNUM, stress_1, stress_2, stress_3, stress_4, stress_5, hr_1, hr_2, hr_3, hr_4, hr_5)
```

#See Prep_Coherence_MIDUSII.R for correlation computation. There, each subject’s set of heart rate and stress measures are subset to their #own data frame and a correlation is computed. The resulting within-subject (i.e., single-subject) r’s compose a new variable in the main #dataframe. ### Center correlations variable



```{r make coherence variable}
#cor between stress and hr within participant, unique for each participant coherence between variables -- dont think it is just at time ponits but an overall coeffecitne between stress andhr



```

### Summary statistics and demographics

```{r}
summary(wDF$P1_race)

wDF$race = as.factor(wDF$P1_race)

summary(wDF$race)
summary(as.factor(wDF$P1_sex))
```


### Cluster mean center
```{r cluster_mean_center}
dfLs$stress_CMC = dfLs$stress - ave(dfLs$stress, dfLs$M2ID, na.rm=T)
dfLs$hr_CMC = dfLs$hr - ave(dfLs$hr, dfLs$M2ID, na.rm=T)
```


### Mean Center
```{r mean_center}
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age, na.rm=T)
# Self reports
dfLs$pwb2_C = dfLs$pwb2 - mean(dfLs$pwb2, na.rm=T)
dfLs$P4_CESD_C = dfLs$P4_CESD- mean(dfLs$P4_CESD, na.rm=T)
dfLs$P4_STAItrait_C = dfLs$P4_STAItrait - mean(dfLs$P4_STAItrait, na.rm=T)
dfLs$COPE_denial_C = dfLs$COPE_denial - mean(dfLs$COPE_denial, na.rm=T)
# Divide pwb, cesd, stai by 10 so SEs larger, interpretable
dfLs$pwb2_C_d10 = dfLs$pwb2_C/10.000000
dfLs$P4_CESD_C_d10 = dfLs$P4_CESD_C/10.000000
dfLs$P4_STAItrait_C_d10 = dfLs$P4_STAItrait_C/10.000000

# Inflammatory
dfLs$IL6_C = dfLs$IL6 - mean(dfLs$IL6, na.rm=T)
dfLs$CRP_C = dfLs$CRP - mean(dfLs$CRP, na.rm=T)
```

```{r}
# Wide data frame
dfLsW$P4_age_C = dfLsW$P4_age - mean(dfLsW$P4_age, na.rm=T)
# Self reports
dfLsW$pwb2_C = dfLsW$pwb2 - mean(dfLsW$pwb2, na.rm=T)
dfLsW$P4_CESD_C = dfLsW$P4_CESD- mean(dfLsW$P4_CESD, na.rm=T)
dfLsW$P4_STAItrait_C = dfLsW$P4_STAItrait - mean(dfLsW$P4_STAItrait, na.rm=T)
dfLsW$COPE_denial_C = dfLsW$COPE_denial - mean(dfLsW$COPE_denial, na.rm=T)
# Inflammatory
dfLsW$IL6_C = dfLsW$IL6 - mean(dfLsW$IL6, na.rm=T)
dfLsW$CRP_C = dfLsW$CRP - mean(dfLsW$CRP, na.rm=T)
# PWB subscales
dfLsW$autonomy2_C = dfLsW$autonomy2 - mean(dfLsW$autonomy2, na.rm=T)
dfLsW$envMast2_C = dfLsW$envMast2 - mean(dfLsW$envMast2, na.rm=T)
dfLsW$persGrow2_C = dfLsW$persGrow2 - mean(dfLsW$persGrow2, na.rm=T)
dfLsW$posRela2_C = dfLsW$posRela2 - mean(dfLsW$posRela2, na.rm=T)
dfLsW$purpLife2_C = dfLsW$purpLife2 - mean(dfLsW$purpLife2, na.rm=T)
dfLsW$selfAcce2_C = dfLsW$selfAcce2 - mean(dfLsW$selfAcce2, na.rm=T)
```

### Log transform inflammatory markers for normal distribution 
```{r logtransform_inflam}
dfLs$IL6_T = log2(dfLs$IL6)
dfLsW$IL6_T = log2(dfLsW$IL6)
hist(dfLs$IL6_T)
dfLs$CRP_T = log(dfLs$CRP, base=10)
dfLsW$CRP_T = log(dfLsW$CRP, base=10)
hist(dfLs$CRP_T)
dfLs$IL6_T_C = dfLs$IL6_T - mean(dfLs$IL6_T, na.rm=T)
dfLs$CRP_T_C = dfLs$CRP_T - mean(dfLs$CRP_T, na.rm=T)
```

# TESTS

## Stress-heart rate coherence associations

### Age
```{r coherence_age}
lmerM = lmer(hr ~ stress_CMC * P4_age_C + (1+ stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### Gender 
```{r coherence_gender}
lmerM = lmer(hr ~ stress_CMC * gender_C + (1+ stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### PWB
```{r coherence_pwb}
# Center age for subjects in this analysis 
varDescribe(dfLs$pwb2_C)
length(dfLs$P4_age[!is.na(dfLs$pwb2_C)])
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age[!is.na(dfLs$pwb2_C)], na.rm=T)
# Run the test 
lmerM = lmer(hr ~ stress_CMC * pwb2_C_d10 + P4_age_C*stress_CMC + (1+ stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### Depression
```{r coherence_depression}
# Center age for subjects in this analysis 
varDescribe(dfLs$P4_CESD_C)
length(dfLs$P4_age[!is.na(dfLs$P4_CESD_C)])
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age[!is.na(dfLs$P4_CESD_C)], na.rm=T)
# Run the test
lmerM = lmer(hr ~ stress_CMC * P4_CESD_C_d10 + P4_age_C*stress_CMC + (1 + stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### Anxiety
```{r coherence_anxiety}
# Center age for subjects in this analysis 
varDescribe(dfLs$P4_STAItrait_C)
length(dfLs$P4_age[!is.na(dfLs$P4_STAItrait_C)])
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age[!is.na(dfLs$P4_STAItrait_C)], na.rm=T)
# Run the test
lmerM = lmer(hr ~ stress_CMC * P4_STAItrait_C_d10 + P4_age_C*stress_CMC + (1 + stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### IL6
```{r coherence_IL6}
# Center age for subjects in this analysis 
varDescribe(dfLs$IL6_T_C)
length(dfLs$P4_age[!is.na(dfLs$IL6_T_C)])
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age[!is.na(dfLs$IL6_T_C)], na.rm=T)
# Run the test
lmerM = lmer(hr ~ stress_CMC * IL6_T_C + P4_age_C*stress_CMC + (1 + stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### CRP
```{r coherence_CRP}
# Center age for subjects in this analysis 
varDescribe(dfLs$CRP_T_C)
length(dfLs$P4_age[!is.na(dfLs$CRP_T_C)])
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age[!is.na(dfLs$CRP_T_C)], na.rm=T)
# Run the test
lmerM = lmer(hr ~ stress_CMC * CRP_T_C + P4_age_C*stress_CMC + (1 + stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   
```

### Denial
```{r denial}
# Center age for subjects in this analysis 
length(dfLs$P4_age[!is.na(dfLs$COPE_denial_C)])
dfLs$P4_age_C = dfLs$P4_age - mean(dfLs$P4_age[!is.na(dfLs$COPE_denial_C)], na.rm=T)
# Run the test 
lmerM = lmer(hr ~ stress_CMC * COPE_denial_C + P4_age_C*stress_CMC + (1+ stress_CMC|M2ID) + (1|M2FAMNUM), data=dfLs)
a = Anova(lmerM, type=3, test="F")
a
summary(lmerM)
table_obj = broom.mixed::tidy(a, effects = c("ran_pars", "fixed"), data=dfLs) 
pander(table_obj, digits = 3)   # Using pander() to view the created table, with 3 sig figs 
```

## Multiple Comparisons Correction
Holm-Bonferonni
```{r multiple_comparisons}
## p value for each test of a well-being marker
p = c(2.99E-07, 2.06E-09, 1.70E-08, 2.91E-06, 0.00762, 6.18E-06)
## Holm-bonferonni
p.adjust(p, method= 'holm')
# 
```


# PLOT

## FIGURE 1: Stress and heart rate by phase histograms

Facet-wrapped histograms of stress and heart rate at each phase of stress induction

```{r stress_by_phase_histograms, fig.width=8, fig.height=3, comment='#'}
ylimits = c(0, 610)
colcode = "#4ECDC1"
stressHist=ggplot()+
geom_histogram(data=dfL, aes(stress), fill=colcode, binwidth=1, color="black") +
facet_wrap(~timepoint, ncol=5) +
labs(x="Self-reported stress", y="Number of subjects") +
ylim(ylimits)+
scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10) )+
theme_bw(base_size=18)+
theme(axis.text.x=element_text(size=14), 
axis.text.y=element_text(size=14),
panel.grid.minor=element_blank(), 
panel.background=element_rect(fill="transparent"), 
plot.background=element_rect(fill="transparent") )
stressHist
#ggsave(stressHist, filename=paste(adir,"/stressHist.png", sep=''), bg="transparent", height=2.8, width=10.45, units="in")
```

```{r hr_by_phase_histograms, fig.width=8, fig.height=3, comment='#'}
xlimits = c(30,150)
ylimits = c(0, 240)
colcode = "#900C3F"
hrHist=ggplot()+
geom_histogram(data=dfL, aes(hr), fill=colcode, binwidth=6, color="black") +
facet_wrap(~timepoint, ncol=5) +
labs(x="Heart rate", y="Number of subjects") +
ylim(ylimits)+
xlim(xlimits)+
geom_vline(xintercept=75, size=.5, color="blue")+
#scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10) )+
theme_bw(base_size=18)+
theme(axis.text.x=element_text(size=14), 
axis.text.y=element_text(size=14),
panel.grid.minor= element_blank(), 
panel.background=element_rect(fill="transparent"), 
plot.background=element_rect(fill="transparent") )
hrHist
#ggsave(hrHist, filename=paste(adir,"/hrHist.png", sep=''), bg="transparent", height=2.8, width=10.45, units="in")
```

## FIGURE 2: Interaction plots

```{r interaction_plots}
# PWB
mod = lmer(hr ~ stress*pwb2 + (1 + stress| M2ID), data=dfLs)
# Prepare independent variables for ggplot
XToPredict = seq(min(dfLs$stress), max(dfLs$stress), length = 100)
pwb2_lo = mean(dfLsW$pwb2, na.rm=T) - sd(dfLsW$pwb2, na.rm=T) 
pwb2_hi = mean(dfLsW$pwb2, na.rm=T) + sd(dfLsW$pwb2, na.rm=T) 
# Use modelPredictions() to generate Y-hats
yHats = expand.grid(stress = XToPredict, pwb2=c(pwb2_lo, pwb2_hi))  # all IVs
yHats = modelPredictions(mod, yHats)
modelplot = ggplot() + 
            geom_smooth(aes(ymin = CILo, ymax = CIHi, x = stress, y = Predicted, 
                  colour=as.factor(pwb2), group=as.factor(pwb2)), 
                  data = yHats, stat = "identity")
#modelplot
pwb2plot = modelplot + scale_x_continuous("Stress", breaks = seq(0, 10, by=1)) + 
             scale_y_continuous("Heart Rate", breaks = seq(60, 100, by=1)) +
             scale_color_manual(name ="PWB",             
                     labels=c("Low (-1SD)", "High (+1SD)"), values=c("#0679A4","#FDA603")) + 
             theme_bw(base_size = 14) +
             theme(legend.position = c(0.75, 0.15), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                  panel.background = element_blank(), axis.line = element_line(colour = "black"))
pwb2plot
## CESD
mod = lmer(hr ~ stress*P4_CESD + (1 + stress| M2ID), data=dfLs)
# Prepare independent variables for ggplot
XToPredict = seq(min(dfLs$stress), max(dfLs$stress), length = 100)
P4_CESD_lo = mean(dfLsW$P4_CESD, na.rm=T) - sd(dfLsW$P4_CESD, na.rm=T) 
P4_CESD_hi = mean(dfLsW$P4_CESD, na.rm=T) + sd(dfLsW$P4_CESD, na.rm=T) 
# Use modelPredictions() to generate Y-hats
yHats = expand.grid(stress = XToPredict, P4_CESD=c(P4_CESD_lo, P4_CESD_hi))  # all IVs
yHats = modelPredictions(mod, yHats)
modelplot = ggplot() + 
  geom_smooth(aes(ymin = CILo, ymax = CIHi, x = stress, y = Predicted, 
                  colour=as.factor(P4_CESD), group=as.factor(P4_CESD)), 
                  data = yHats, stat = "identity")
#modelplot
P4_CESDplot = modelplot + scale_x_continuous("Stress", breaks = seq(0, 10, by=1)) + 
             scale_y_continuous("Heart Rate", breaks = seq(60, 100, by=1)) +
             scale_color_manual(name ="Depression",             
                     labels=c("Low (-1SD)", "High (+1SD)"), values=c("#FDA603","#0679A4")) + 
             theme_bw(base_size = 14) +
             theme(legend.position = c(0.75, 0.15), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                   panel.background = element_blank(), axis.line = element_line(colour = "black"))
P4_CESDplot
## P4_STAItrait
mod = lmer(hr ~ stress*P4_STAItrait +(1 + stress| M2ID), data=dfLs)
# Prepare independent variables for ggplot
XToPredict = seq(min(dfLs$stress), max(dfLs$stress), length = 100)
P4_STAItrait_lo = mean(dfLsW$P4_STAItrait, na.rm=T) - sd(dfLsW$P4_STAItrait, na.rm=T) 
P4_STAItrait_hi = mean(dfLsW$P4_STAItrait, na.rm=T) + sd(dfLsW$P4_STAItrait, na.rm=T) 
# Use modelPredictions() to generate Y-hats
yHats = expand.grid(stress = XToPredict, P4_STAItrait=c(P4_STAItrait_lo, P4_STAItrait_hi))  # all IVs
yHats = modelPredictions(mod, yHats)
modelplot = ggplot() + 
  geom_smooth(aes(ymin = CILo, ymax = CIHi, x = stress, y = Predicted, 
                  colour=as.factor(P4_STAItrait), group=as.factor(P4_STAItrait)), 
                  data = yHats, stat = "identity")
#modelplot
P4_STAItraitplot = modelplot + scale_x_continuous("Stress", breaks = seq(0, 10, by=1)) + 
                   scale_y_continuous("Heart Rate", breaks = seq(60, 100, by=1)) +
                   scale_color_manual(name ="Trait Anxiety",             
                     labels=c("Low (-1SD)", "High (+1SD)"), values=c("#FDA603","#0679A4")) + 
                   theme_bw(base_size = 14) +
                   theme(legend.position = c(0.75, 0.15), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                         panel.background = element_blank(), axis.line = element_line(colour = "black"))
P4_STAItraitplot
## IL6
mod = lmer(hr ~ stress*IL6_T + (1 + stress| M2ID), data=dfLs)
# Prepare independent variables for ggplot
XToPredict = seq(min(dfLs$stress), max(dfLs$stress), length = 100)
IL6_T_lo = mean(dfLsW$IL6_T, na.rm=T) - sd(dfLsW$IL6_T, na.rm=T) 
IL6_T_hi = mean(dfLsW$IL6_T, na.rm=T) + sd(dfLsW$IL6_T, na.rm=T) 
# Use modelPredictions() to generate Y-hats
yHats = expand.grid(stress = XToPredict, IL6_T=c(IL6_T_lo, IL6_T_hi))  # all IVs
yHats = modelPredictions(mod, yHats)
# Starting plot in which we graph regression lines
modelplot = ggplot() + 
  geom_smooth(aes(ymin = CILo, ymax = CIHi, x = stress, y = Predicted, 
                  colour=as.factor(IL6_T), group=as.factor(IL6_T), lineIL6_T=as.factor(IL6_T)), 
                  data = yHats, stat = "identity")
#modelplot
IL6_Tplot = modelplot + scale_x_continuous("Stress", breaks = seq(0, 10, by=1)) + 
             scale_y_continuous("Heart Rate", breaks = seq(60, 100, by=1)) +
             scale_color_manual(name ="IL-6 (log2)",             
                     labels=c("Low (-1SD)", "High (+1SD)"), values=c("#FDA603","#0679A4")) + 
             theme_bw(base_size = 14) +
             theme(legend.position = c(0.75, 0.15), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                         panel.background = element_blank(), axis.line = element_line(colour = "black"))
                   
IL6_Tplot
## CRP
mod = lmer(hr ~ stress*CRP_T + (1 + stress| M2ID), data=dfLs)
# Prepare independent variables for ggplot
XToPredict = seq(min(dfLs$stress), max(dfLs$stress), length = 100)
CRP_T_lo = mean(dfLsW$CRP_T, na.rm=T) - sd(dfLsW$CRP_T, na.rm=T) 
CRP_T_hi = mean(dfLsW$CRP_T, na.rm=T) + sd(dfLsW$CRP_T, na.rm=T) 
# Use modelPredictions() to generate Y-hats
yHats = expand.grid(stress = XToPredict, CRP_T=c(CRP_T_lo, CRP_T_hi))  # all IVs
yHats = modelPredictions(mod, yHats)
modelplot = ggplot() + 
  geom_smooth(aes(ymin = CILo, ymax = CIHi, x = stress, y = Predicted, 
                  colour=as.factor(CRP_T), group=as.factor(CRP_T), lineCRP_T=as.factor(CRP_T)), 
              data = yHats, stat = "identity")
#modelplot
CRP_Tplot = modelplot + scale_x_continuous("Stress", breaks = seq(0, 10, by=1)) + 
            scale_y_continuous("Heart Rate", breaks = seq(60, 100, by=1)) +
            scale_color_manual(name ="CRP (log10)",             
                     labels=c("Low (-1SD)", "High (+1SD)"), values=c("#FDA603","#0679A4")) + 
            theme_bw(base_size = 14) +
            theme(legend.position = c(0.75, 0.15), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                        panel.background = element_blank(), axis.line = element_line(colour = "black"))
                  
CRP_Tplot
## Denial
mod = lmer(hr ~ stress*COPE_denial + (1 + stress| M2ID), data=dfLs)
# Prepare independent variables for ggplot
XToPredict = seq(min(dfLs$stress), max(dfLs$stress), length = 100)
COPE_denial_lo = mean(dfLsW$COPE_denial, na.rm=T) - sd(dfLsW$COPE_denial, na.rm=T) 
COPE_denial_hi = mean(dfLsW$COPE_denial, na.rm=T) + sd(dfLsW$COPE_denial, na.rm=T) 
# Use modelPredictions() to generate Y-hats
yHats = expand.grid(stress = XToPredict, COPE_denial=c(COPE_denial_lo, COPE_denial_hi))  # all IVs
yHats = modelPredictions(mod, yHats)
modelplot = ggplot() + 
  geom_smooth(aes(ymin = CILo, ymax = CIHi, x = stress, y = Predicted, 
                  colour=as.factor(COPE_denial), group=as.factor(COPE_denial), lineCOPE_denial=as.factor(COPE_denial)), 
                  data = yHats, stat = "identity")
#modelplot
COPE_denialplot = modelplot + scale_x_continuous("Stress", breaks = seq(0, 10, by=1)) + 
             scale_y_continuous("Heart Rate", breaks = seq(60, 100, by=1)) +
             scale_color_manual(name ="Denial coping",             
                     labels=c("Low (-1SD)", "High (+1SD)"), values=c("#FDA603","#0679A4")) + 
             theme_bw(base_size = 14) +
             theme(legend.position = c(0.75, 0.15), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
                         panel.background = element_blank(), axis.line = element_line(colour = "black"))
COPE_denialplot
```
